<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registration & Login</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
      * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
        font-family: "Poppins", serif;
      }
     body{
      background: #eaf6ff;;
     }
      .container {
        background-color: #fff;
        width: 450px;
        padding: 1.5rem;
        margin: 50px auto;
        border-radius: 10px;
        box-shadow: 0 20px 35px rgba(0, 0, 1, 0.9);
      }
    
      form {
        margin: 0 2rem;
      }
    
      .form-title {
        font-size: 1.5rem;
        font-weight: bold;
        text-align: center;
        padding: 1.3rem;
        margin-bottom: 0.4rem;
      }
    
      input {
        color: inherit;
        width: 100%;
        background-color: transparent;
        border: none;
        border-bottom: 1px solid #757575;
        padding-left: 1.5rem;
        font-size: 15px;
      }
    
      .input-group {
        padding: 1% 0;
        position: relative;
      }
    
      .input-group i {
        position: absolute;
        color: black;
        margin-top: 5px;
      }
    
      input:focus {
        background-color: transparent;
        outline: transparent;
        border-bottom: 2px solid hsl(327, 90%, 28%);
      }
    
      input::placeholder {
        color: transparent;
      }
    
      label {
        color: #757575;
        position: relative;
        left: 1.2em;
        top: -1.5em;
        cursor: auto;
        transition: 0.3s ease all;
      }
    
      input:focus~label,
      input:not(:placeholder-shown)~label {
        top: -3em;
        color: hsl(327, 90%, 28%);
        font-size: 15px;
      }
    
      .recover {
        text-align: right;
        font-size: 1rem;
        margin-bottom: 1rem;
      }
    
      .recover a {
        text-decoration: none;
        color: rgb(125, 125, 235);
      }
    
      .recover a:hover {
        color: blue;
        text-decoration: underline;
      }
    
      .btn {
        font-size: 1.1rem;
        padding: 8px 0;
        border-radius: 5px;
        outline: none;
        border: none;
        width: 100%;
        background-color: rgb(125, 125, 235);
        color: #fff;
        cursor: pointer;
        transition: 0.9s;
      }
    
      .btn:hover {
        background-color: #07001f;
      }
    
      .or {
        text-align: center;
        margin-top: 0.5rem;
        font-size: 1.1rem;
      }
    
      .icons {
        text-align: center;
      }
    
      .icons i {
        color: rgb(125, 125, 235);
        padding: 0.8rem 1.5rem;
        border-radius: 10px;
        font-size: 1.5rem;
        cursor: pointer;
        border: 2px solid #dfe9f5;
        margin: 0 15px;
        transition: 1s;
      }
    
      .icons i:hover {
        background-color: #07001f;
        font-size: 1.6rem;
        border: 2px solid rgb(125, 125, 235);
      }
    
      .links {
        display: flex;
        justify-content: space-around;
        padding: 0 4rem;
        margin-top: 0.9rem;
        font-weight: bold;
      }
    
      button {
        color: rgb(125, 125, 235);
        border: none;
        background-color: transparent;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
      }
    
      button:hover {
        text-decoration: underline;
        color: blue;
      }
    
      /* Navbar */
      .navbar {
        height: 50px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background:linear-gradient(90deg, #2c3e50, #3498db);
        color: white;
        padding: 10px 20px;
        font-family: 'Poppins', sans-serif;
      }
    
      .navbar .greeting {
        font-size: 1.2rem;
      }
    
      .navbar .logout {
        cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            font-size: 1rem;
            color: #ecf0f1;
            transition: all 0.3s ease;
      }
    
      .navbar .logout:hover {
        color: #ff5252;
        transform: scale(1.1);
      } 
    </style> 
</head>

<body>
  <!-- Navbar -->
  <div class="navbar">
   <p>Hi, Nishneeth Kotagiri</p>
    <form action="/api/managerlogout" method="post">
      <button class="logout" id="logoutButton">Logout</button>
    </form>
  </div>

  <!-- SignUp Form -->
  <div class="container" id="signup" style="display: none;">
    <h1 class="form-title">SignUp</h1>
    <form method="post" id="signUpForm">
      <div class="input-group">
        <i class="fas fa-user"></i>
        <input type="text" name="fName" id="fName" placeholder="First Name" required />
        <label for="fName">First Name</label>
      </div>
      <div class="input-group">
        <i class="fas  fa-user"></i>
        <input type="text" name="lName" id="lName" placeholder="Last Name" required />
        <label for="lName">Last Name</label>
      </div>
      <div class="input-group">
        <i class="fas fa-envelope"></i>
        <input type="text" name="Acc_num" id="Acc_num" placeholder="Acc_num" required />
        <label for="Acc_num">Acc_num</label>
      </div>

      <div class="input-group">
        <i class="fa fa-upload"></i>
        <input type="file" id="signature" name="signature" accept=".jpg, .jpeg, .png, .gif" required hidden />
        <label for="signature" style="position:relative; top: 2px;">Upload Your Signature</label>
        <br>
      </div>

      <input type="submit" class="btn" value="Sign Up" name="signUp">
    </form>

    <p id="message"></p>
    <div class="links">
      <p>Already Have Account ?</p>
      <button id="signInButton">Sign In</button>
    </div>
  </div>

  <!-- SignIn Form -->
 <!-- SignIn Form -->
 <div class="container" id="signIn" style="position: relative; top:100px;">
  <h1 class="form-title">Login</h1>
  <form method="post" action="/api/login" id="login">
    <div class="input-group">
      <i class="fas fa-envelope"></i>
      <input type="text" name="Acc_num" id="Email" placeholder="Email" required />
      <label for="email">Account Number</label>
    </div>
    <input type="submit" class="btn" value="Sign In" name="signIn">
  </form>
  <div class="links">
    <p>Don't have account yet ?</p>
    <button id="signUpButton">Sign Up</button>
  </div>
</div>

  <script>
    // Assuming the manager's name is stored in sessionStorage after login
    const managerName = sessionStorage.getItem('managerName') || 'Manager';
    const greeting = document.getElementById('managerGreeting');
    // greeting.textContent = Hi, ${managerName};

    // Logout functionality
    const logoutButton = document.getElementById('logoutButton');
    logoutButton.addEventListener('click', () => {
      sessionStorage.removeItem('managerName');
      window.location.href = '/pi/home'; // Redirect to homepage
    });

    const signUpButton = document.getElementById('signUpButton');
    const signInButton = document.getElementById('signInButton');
    const signInForm = document.getElementById('signIn');
    const signUpForm = document.getElementById('signup');

    signUpButton.addEventListener('click', function () {
      signInForm.style.display = "none";
      signUpForm.style.display = "block";
    });

    signInButton.addEventListener('click', function () {
      signInForm.style.display = "block";
      signUpForm.style.display = "none";
    });
    
    document.getElementById('signUpForm').addEventListener('submit', async function(event) {
      event.preventDefault();

      const fname = document.getElementById('fName').value;
      const lname = document.getElementById('lName').value;
      const Acc_num = document.getElementById('Acc_num').value;
      const signature = document.getElementById('signature').files[0];
      const message = document.getElementById('message');

      if (!signature) {
        message.textContent = 'Please upload a signature.';
        message.style.color = 'red';
        return;
      }

      const formData = new FormData();
      formData.append('fName', fname);
      formData.append('lName', lname);
      formData.append('Acc_num', Acc_num);
      formData.append('signature', signature);

      try {
        const response = await fetch('/api/signup', {
          method: 'POST',
          body: formData,
        });

        if (!response.ok) throw new Error('Network response was not ok');

        const data = await response.json();

        if (!data.success) {
          message.textContent = data.message || 'User already exists';
          message.style.color = 'red';
        } else {
          message.textContent = 'Registration successful';
          message.style.color = 'green';
          setTimeout(() => window.location.href = '/api/login', 1000);
        }
      } catch (error) {
        console.error('Error during fetch:', error);
        message.textContent = 'An error occurred. Please try again.';
        message.style.color = 'red';
      }
    });

    // Login form submission
    document.getElementById('login').addEventListener('submit', async function(event) {
            event.preventDefault();
            let Acc_num = document.getElementById("Email").value;
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ Acc_num }),
            });
            const data = await response.json();
            console.log(data.success)
            if (data.success) {
                        window.location.href = '/api/dashboard';
            } else {
                alert("Invalid login");
            }
        });
         </script>
</body>
</html>